# 🔥 COMPLETE FIREBASE SETUP GUIDE - DayPilot

## 🚨 CRITICAL: Fix Package Name Mismatch First!

### Current Problem:
- **google-services.json** has package: `com.daypilot`
- **Your app** uses package: `com.daypilot.app`
- **Result:** Firebase SDK can't connect properly!

---

## 📋 STEP 1: Register Android App in Firebase Console

### Go to Firebase Console:
1. Open: https://console.firebase.google.com
2. Select project: **DayPilot** (pesitm-connect)
3. Click **⚙️ Project Settings** (gear icon, top left)
4. Scroll to **"Your apps"** section
5. Click **Android icon** to add Android app

### Register App Details:
```
Android package name: com.daypilot.app
App nickname: DayPilot Android
Debug signing certificate SHA-1: (optional, leave blank for now)
```

6. Click **"Register app"**
7. **Download new google-services.json** file
8. Replace the old one in: `android/app/google-services.json`

---

## 📋 STEP 2: Update Gradle Files (Already Done ✅)

### Root build.gradle.kts
Already has:
```kotlin
plugins {
  id("com.google.gms.google-services") version "4.4.4" apply false
}
```

### App build.gradle.kts  
Already has:
```kotlin
plugins {
    id("com.google.gms.google-services")
}

dependencies {
    implementation(platform("com.google.firebase:firebase-bom:34.4.0"))
}
```

✅ **These are correct!**

---

## 📋 STEP 3: Update Firestore Security Rules

### Current Rules (I can see in screenshot):
```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
      match /{document=**} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }
    }
  }
}
```

✅ **These are PERFECT!** Already deployed.

---

## 📋 STEP 4: Enable Authentication

### Already Enabled (I can see in screenshot):
✅ Email/Password - **Enabled**
⚪ Email link (passwordless) - Disabled

**Perfect! No changes needed here.**

---

## 📋 STEP 5: Update google-services.json

**CRITICAL ACTION REQUIRED:**

1. Go to Firebase Console → Project Settings → Your apps
2. Click on **Android icon** (or existing Android app if listed)
3. If you see `com.daypilot` → DELETE IT
4. Add NEW Android app with package: **`com.daypilot.app`**
5. Download the NEW google-services.json
6. Replace file at: `d:\flutterapp\android\app\google-services.json`

### Expected New File Content:
```json
{
  "project_info": {
    "project_number": "709481313590",
    "project_id": "pesitm-connect",
    "storage_bucket": "pesitm-connect.firebasestorage.app"
  },
  "client": [
    {
      "client_info": {
        "mobilesdk_app_id": "1:709481313590:android:XXXXXXXXXX",
        "android_client_info": {
          "package_name": "com.daypilot.app"  // ← THIS MUST MATCH!
        }
      },
      "api_key": [
        {
          "current_key": "AIzaSyDaNTSD9Aoag_mQJI7THyeClxhT4nVJpZs"
        }
      ]
    }
  ]
}
```

---

## 📋 STEP 6: Create Firebase Options File

This file will be auto-generated by FlutterFire CLI, but we can create it manually:

**File:** `lib/firebase_options.dart`

```dart
import 'package:firebase_core/firebase_core.dart' show FirebaseOptions;
import 'package:flutter/foundation.dart'
    show defaultTargetPlatform, kIsWeb, TargetPlatform;

class DefaultFirebaseOptions {
  static FirebaseOptions get currentPlatform {
    if (kIsWeb) {
      return web;
    }
    switch (defaultTargetPlatform) {
      case TargetPlatform.android:
        return android;
      case TargetPlatform.iOS:
        return ios;
      case TargetPlatform.macOS:
        throw UnsupportedError(
          'DefaultFirebaseOptions have not been configured for macos - '
          'you can reconfigure this by running the FlutterFire CLI again.',
        );
      case TargetPlatform.windows:
        throw UnsupportedError(
          'DefaultFirebaseOptions have not been configured for windows - '
          'you can reconfigure this by running the FlutterFire CLI again.',
        );
      case TargetPlatform.linux:
        throw UnsupportedError(
          'DefaultFirebaseOptions have not been configured for linux - '
          'you can reconfigure this by running the FlutterFire CLI again.',
        );
      default:
        throw UnsupportedError(
          'DefaultFirebaseOptions are not supported for this platform.',
        );
    }
  }

  static const FirebaseOptions android = FirebaseOptions(
    apiKey: 'AIzaSyDaNTSD9Aoag_mQJI7THyeClxhT4nVJpZs',
    appId: '1:709481313590:android:YOUR_APP_ID_HERE',
    messagingSenderId: '709481313590',
    projectId: 'pesitm-connect',
    storageBucket: 'pesitm-connect.firebasestorage.app',
  );

  static const FirebaseOptions ios = FirebaseOptions(
    apiKey: 'YOUR_IOS_API_KEY',
    appId: 'YOUR_IOS_APP_ID',
    messagingSenderId: '709481313590',
    projectId: 'pesitm-connect',
    storageBucket: 'pesitm-connect.firebasestorage.app',
    iosBundleId: 'com.daypilot.app',
  );

  static const FirebaseOptions web = FirebaseOptions(
    apiKey: 'AIzaSyDaNTSD9Aoag_mQJI7THyeClxhT4nVJpZs',
    appId: 'YOUR_WEB_APP_ID',
    messagingSenderId: '709481313590',
    projectId: 'pesitm-connect',
    storageBucket: 'pesitm-connect.firebasestorage.app',
    authDomain: 'pesitm-connect.firebaseapp.com',
  );
}
```

---

## 📋 STEP 7: Database Structure

### Firestore Collections:

#### 1. **users** Collection
```
users/
  ├─ {userId}/ (document ID = Firebase Auth UID)
      ├─ uid: string
      ├─ email: string
      ├─ username: string
      ├─ photoUrl: string? (optional)
      ├─ bio: string? (optional)
      ├─ createdAt: timestamp
      ├─ lastActive: timestamp
      ├─ preferences: map (optional)
          ├─ theme: string
          ├─ notifications: boolean
```

#### 2. **tasks** Subcollection (under users)
```
users/{userId}/tasks/
  ├─ {taskId}/
      ├─ id: string
      ├─ title: string
      ├─ description: string
      ├─ startTime: timestamp
      ├─ endTime: timestamp
      ├─ completed: boolean
      ├─ priority: string
      ├─ category: string
      ├─ createdAt: timestamp
```

#### 3. **routines** Subcollection (under users)
```
users/{userId}/routines/
  ├─ {routineId}/
      ├─ id: string
      ├─ name: string
      ├─ tasks: array
      ├─ schedule: map
      ├─ active: boolean
      ├─ createdAt: timestamp
```

---

## 📋 STEP 8: Clean & Rebuild

After updating google-services.json:

```powershell
# Clean project
flutter clean

# Get dependencies
flutter pub get

# Rebuild
flutter run -d emulator-5554
```

---

## ✅ COMPLETE SETUP CHECKLIST

### Firebase Console:
- [ ] Add Android app with package: **com.daypilot.app**
- [ ] Download NEW google-services.json
- [ ] Email/Password auth is enabled ✅
- [ ] Firestore database created ✅
- [ ] Firestore rules deployed ✅

### Local Files:
- [ ] Replace android/app/google-services.json with NEW file
- [ ] Create lib/firebase_options.dart
- [ ] Run `flutter clean`
- [ ] Run `flutter pub get`
- [ ] Run `flutter run`

### Testing:
- [ ] App builds successfully
- [ ] Firebase initializes
- [ ] Sign up new user
- [ ] User appears in Firebase Auth
- [ ] User profile created in Firestore
- [ ] Login works
- [ ] Profile edit works

---

## 🎯 NEXT STEPS

1. **First:** Add Android app in Firebase Console with correct package name
2. **Second:** Download and replace google-services.json  
3. **Third:** I'll create the firebase_options.dart file
4. **Fourth:** We'll test everything

**Ready to proceed?** Let me know when you've:
1. Added the Android app in Firebase Console
2. Downloaded the new google-services.json

Then I'll create all the fresh authentication and database code! 🚀
